<!DOCTYPE html>
<html>
<head>
    <title>API Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.000, maximum-scale=1.000, user-scalable=no, shrink-to-fit=no">
    <meta charset="utf-8">
    <style>
        @font-face {
            font-family: '2';
            src: url('https://forumstatic.ru/files/001a/a3/94/73088.ttf?v=1');
        }
        body {
            background: #000000;
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-size: 16px;
            color: #ffffff;
            font-family: '2';
        }
        .header-title {
            font-size: 26px;
            font-weight: 700;
            color: orange;
            margin: 20px 0;
        }
        table {
            width: 100%;
            margin-bottom: 20px;
            font-family: '2';
        }
        th, td {
    padding: 10px;
    text-align: left;
    border: 1px solid #ffffff; /* Добавляем границу */
    font-family: '2';
}

        th {
    background-color: #222; /* Опционально: добавляем фоновый цвет для заголовков */
}
    </style>
</head>
<body>
    <div style="text-align: center; margin-bottom: 20px;">
        <button onclick="loadLeaderboards()" style="padding: 15px 30px; font-size: 18px;">Обновить таблицы</button><br>
        <button onclick="loadLeaderboards2()" style="padding: 15px 30px; font-size: 18px;">Обновить таблицы</button>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Топ по гемам</div>
        <div id="gemsTable" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Место</th>
                        <th>Имя</th>
                        <th>Гемы</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Топ по опыту</div>
        <div id="xpTable" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Место</th>
                        <th>Имя</th>
                        <th>XP</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Топ по кликам</div>
        <div id="clicksTable" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Место</th>
                        <th>Имя</th>
                        <th>Клики</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Топ по звездам</div>
        <div id="starsTable" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Место</th>
                        <th>Имя</th>
                        <th>Звёзды</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Топ по спинам</div>
        <div id="spinsTable" class="table-wrapper">
            <table>
                <thead>
                    <th>Место</th>
                    <th>Имя</th>
                    <th>Спины</th>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Статистика мониторинга</div>
        <div id="statsTable" class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>Показатель</th>
                        <th>Значение</th>
                    </tr>
                </thead>
                <tbody>
                </tbody>
            </table>
        </div>
    </div>

    <div class="leaderboard-container">
        <div class="header-title">Информация об обновлении</div>
        <div id="updateInfo">
            <p>Последнее обновление: <span id="lastUpdate"></span></p>
        </div>
    </div>

    <script>
    async function loadLeaderboards() {
        try {
            const response = await fetch('http://192.168.1.64:5000/api/users/all');
            const data = await response.json();
            
            // Функция для заполнения таблицы
            function fillTable(tableId, sortField, fieldName) {
                const tableBody = document.querySelector(`${tableId} tbody`);
                tableBody.innerHTML = '';
                
                // Сортируем данные по нужному полю
                const sortedData = [...data].sort((a, b) => b[sortField] - a[sortField]);
                
                // Заполняем таблицу
                sortedData.slice(0, 6).forEach((player, index) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${player.first_name}</td>
                        <td>${player[sortField]}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
            
            // Заполняем все таблицы
            fillTable('#gemsTable', 'gems', 'Гемы');
            fillTable('#xpTable', 'xp', 'XP');
            fillTable('#clicksTable', 'click_count', 'Клики');
            fillTable('#starsTable', 'stars', 'Звёзды');
            fillTable('#spinsTable', 'spin_count', 'Спины');
            
        } catch (error) {
            console.error('Ошибка:', error);
        }
    }

    // Загружаем таблицы при загрузке страницы
    window.addEventListener('load', loadLeaderboards);
    
    async function loadLeaderboards2() {
        try {
            const response = await fetch('http://192.168.1.64:5000/api/monitoring');
            const data = await response.json();
            
            // Заполняем таблицу статистики
            const statsTableBody = document.querySelector('#statsTable tbody');
            statsTableBody.innerHTML = '';
            
            // Массив для отображения нужных показателей
            const statsFields = [
                { key: 'monitoring_players', name: 'Количество игроков' },
                { key: 'monitoring_mau', name: 'MAU' },
                { key: 'monitoring_click_count', name: 'Общее количество кликов' },
                { key: 'monitoring_xp', name: 'Общий XP' },
                { key: 'monitoring_gems', name: 'Общие гемы' },
                { key: 'monitoring_payed_gems', name: 'Купленные гемы' },
                { key: 'monitoring_withdraw_gems', name: 'Выведенные гемы' },
                { key: 'monitoring_bank_gems', name: 'Гемы в банке' },
                { key: 'monitoring_stars', name: 'Общие звезды' },
                { key: 'monitoring_payed_stars', name: 'Купленные звезды' },
                { key: 'monitoring_withdraw_stars', name: 'Выведенные звезды' },
                { key: 'monitoring_bank_stars', name: 'Звезды в банке' },
                { key: 'monitoring_spin_count', name: 'Общее количество спинов' },
                { key: 'monitoring_win_spin_count', name: 'Выигрышные спины' },
                { key: 'monitoring_lose_spin_count', name: 'Проигрышные спины' }
            ];
            
            // Заполняем строки таблицы
            statsFields.forEach(field => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${field.name}</td>
                    <td>${data[field.key] || 0}</td>
                `;
                statsTableBody.appendChild(row);
            });
            
            // Обновляем информацию о последнем обновлении
            document.getElementById('lastUpdate').textContent = data.last_updated || 'Данные отсутствуют';
            
        } catch (error) {
            console.error('Ошибка:', error);
            alert('Не удалось загрузить данные. Попробуйте обновить страницу.');
        }
    }

    window.addEventListener('load', loadLeaderboards2);
    </script>
</body>
</html>
